WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WGLWidget",function(u,f){function v(){for(var b=jQuery.data(f,"obj"),a="",c=0;c<b.jsMatrices.length;c++){a+=c+":";for(var i=0;i<b.jsMatrices[c].length;i++){a+=b.jsMatrices[c][i];a+=i!=15?",":";"}}return a}jQuery.data(f,"obj",this);var d=u.WT,l=d.glMatrix.vec3,e=d.glMatrix.mat4;this.ctx=null;this.initializeGL=function(){};this.paintGL=function(){};this.resizeGL=function(){};this.updates=[];this.initialized=false;this.preloadingBuffers=this.preloadingTextures=
0;this.jsMatrices=[];var g=null,j=null,p=null,q=0,r=0,h=null,s=0,t=0,o=null,m=null,n=null;this.discoverContext=function(b){if(f.getContext){try{this.ctx=f.getContext("webgl",{antialias:true})}catch(a){}if(this.ctx==null)try{this.ctx=f.getContext("experimental-webgl")}catch(c){}if(this.ctx==null){f.parentNode.insertBefore(f.firstChild,f);f.style.display="none";b()}}return this.ctx};this.setLookAtParams=function(b,a,c,i,k){h=b;j=a;p=c;q=i;r=k};this.rotate=function(b){var a=b.x-g.x,c=b.y-g.y,i=l.create();
i[0]=h[0];i[1]=h[4];i[2]=h[8];var k=e.create();e.identity(k);e.translate(k,j);e.rotate(k,c*q,i);e.rotate(k,a*r,p);l.negate(j);e.translate(k,j);l.negate(j);e.multiply(h,k,h);this.paintGL();g=b};this.zoom=function(b){b=Math.pow(1.2,b);e.translate(h,j);e.scale(h,[b,b,b]);l.negate(j);e.translate(h,j);l.negate(j);this.paintGL()};this.mouseWheelLookAt=function(b,a){d.cancelEvent(a);this.zoom(d.wheelDelta(a))};this.setWalkParams=function(b,a,c){h=b;s=a;t=c};this.walk=function(b){var a=b.x-g.x;b=b.y-g.y;
var c=e.create();e.identity(c);e.rotateY(c,a*t);a=l.create();a[0]=0;a[1]=0;a[2]=-s*b;e.translate(c,a);e.multiply(c,h,h);this.paintGL();g=d.pageCoordinates(event)};this.mouseDragWalk=function(b,a){g!=null&&this.walk(d.pageCoordinates(a))};this.mouseDragLookAt=function(b,a){g!=null&&this.rotate(d.pageCoordinates(a))};this.mouseDown=function(b,a){if(!(a.button!=0&&!d.isIElt9))if(!(d.isIElt9&&a.button!=1)){d.capture(null);d.capture(f);g=d.pageCoordinates(a)}};this.mouseUp=function(){if(g!=null)g=null};
this.touchStart=function(b,a){m=a.touches.length==1?true:false;n=a.touches.length==2?true:false;if(m){d.capture(null);d.capture(f);g=d.pageCoordinates(a.touches[0])}else if(n){b=d.pageCoordinates(a.touches[0]);var c=d.pageCoordinates(a.touches[1]);o=Math.sqrt((b.x-c.x)*(b.x-c.x)+(b.y-c.y)*(b.y-c.y))}else return;a.preventDefault()};this.touchEnd=function(b,a){var c=a.touches.length==0?true:false;m=a.touches.length==1?true:false;n=a.touches.length==2?true:false;c&&this.mouseUp(null,null);if(m||n)this.touchStart(b,
a)};this.touchMoved=function(b,a){if(m||n){a.preventDefault();m&&this.mouseDragLookAt(b,a.touches[0]);if(n){b=d.pageCoordinates(a.touches[0]);a=d.pageCoordinates(a.touches[1]);a=Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y));b=a/o;if(!(Math.abs(b-1)<0.05)){b=b>1?1:-1;o=a;this.zoom(b)}}}};this.handlePreload=function(){if(this.preloadingTextures==0&&this.preloadingBuffers==0){if(this.initialized){var b;for(b in this.updates)this.updates[b]();this.updates=[]}else this.initializeGL();this.resizeGL();
this.paintGL()}};f.wtEncodeValue=v});
