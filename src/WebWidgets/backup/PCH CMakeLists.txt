INCLUDE(CMake/PCH.cmake)

#Get Files Lists
FILE(GLOB_RECURSE sources_cmake CMakeFiles/*.cmake)
FILE(GLOB_RECURSE sources_objects Objects/*.cpp)
FILE(GLOB_RECURSE headers_objects Objects/*.h)
FILE(GLOB_RECURSE sources_dbo Dbo/*.cpp)
FILE(GLOB_RECURSE headers_dbo Dbo/*.h)
FILE(GLOB_RECURSE sources_dbodatabase DboDatabase/*.cpp)
FILE(GLOB_RECURSE headers_dbodatabase DboDatabase/*.h)
FILE(GLOB_RECURSE sources_application Application/*.cpp)
FILE(GLOB_RECURSE headers_application Application/*.h)
FILE(GLOB sources_localdir *.cpp)
FILE(GLOB headers_localdir *.h)

#Remove PCH.cpp
FOREACH(source_localdir ${sources_localdir})
	IF(source_localdir MATCHES "PCH.cpp")
		LIST(REMOVE_ITEM sources_localdir ${source_localdir})
	ENDIF(source_localdir MATCHES "PCH.cpp")
ENDFOREACH(source_localdir)

#Group File
SOURCE_GROUP(CMake FILES CMakeLists.txt ${sources_cmake})
SOURCE_GROUP(Objects FILES ${sources_objects} ${headers_objects})
SOURCE_GROUP(Dbo FILES ${sources_dbo} ${headers_dbo})
SOURCE_GROUP(DboDatabase FILES ${sources_dbodatabase} ${headers_dbodatabase})
SOURCE_GROUP(Application FILES ${sources_application} ${headers_application})
SOURCE_GROUP("" FILES ${sources_localdir} ${headers_localdir} PCH.cpp)

#Concat Files Lists
SET(MM_HEADERS
	${headers_objects}
	${headers_dbo}
	${headers_dbodatabase}
	${headers_application}
	${headers_localdir}
)
SET(MM_CPP
	${sources_cmake}
	${sources_objects} 
	${sources_dbo} 
	${sources_dbodatabase} 
	${sources_application}
	${sources_localdir}
)
SET(MM_SRCS
	${MM_CPP}
	${MM_HEADERS}
)

#Create PCH header
FILE(REMOVE "PCH.h")
FILE(WRITE "PCH.h" "#ifndef PCH_H_\n#define PCH_H_\n\n")
FOREACH(loopval ${MM_HEADERS})
	FILE(APPEND "PCH.h" "#include \"" ${loopval} "\"\n")
ENDFOREACH(loopval)
FILE(APPEND "PCH.h" "\n#endif //PCH_H_")

#Set Target/Project name
SET(WT_PROJECT_TARGET MM.wt)
ADD_MSVC_PRECOMPILED_HEADER("PCH.h" "PCH.cpp" MM_SRCS)

#Add Program CXX files
ADD_EXECUTABLE(${WT_PROJECT_TARGET} ${MM_SRCS})

#Link Libraries
TARGET_LINK_LIBRARIES(${WT_PROJECT_TARGET}
	wthttp
	wt
	wtdbo
	wtdbomysql
	wtdbosqlite3
#	wtdbofirebird
#	wtdbopostgres
	${MYSQL_LIBRARY}
)
#Link Directories
INCLUDE_DIRECTORIES(
	${CMAKE_CURRENT_SOURCE_DIR}
	${MYSQL_INCLUDE_DIR}
)

#Configuration
IF(WIN32)
	FILE(COPY
		${MYSQL_DLL_DIR}/libmysql.dll ${MYSQL_DLL_DIR}/libmysql.pdb
		DESTINATION ${CMAKE_CURRENT_BINARY_DIR}/${CMAKE_BUILD_TYPE}
	)
ENDIF()

#Installation
if(WIN32)
	INSTALL(FILES
		${MYSQL_DLL_DIR}/libmysql.dll
		DESTINATION bin
	)
ENDIF()